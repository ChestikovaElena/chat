(()=>{var e={684:e=>{e.exports=class{constructor(){this.events=[]}on(e,t){this.events.push({event:e,cb:t})}emit(e,t){const o=this.events.find((t=>t.event===e));o&&o.cb(t)}}}},t={};function o(s){var n=t[s];if(void 0!==n)return n.exports;var r=t[s]={exports:{}};return e[s](r,r.exports,o),r.exports}o.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return o.d(t,{a:t}),t},o.d=(e,t)=>{for(var s in t)o.o(t,s)&&!o.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";const e={render(e,t){e+="Template";const o=document.getElementById(e).textContent;return Handlebars.compile(o)(t)}},t=/<|>\/|'|\u2028|\u2029/g,s={"<":"&lt;",">":"&gt;",'"':"&quot;","'":"\\u0027","</":"<\\u002F","\u2028":"\\u2028","\u2029":"\\u2029"},n=e=>s[e];var r=o(684),a=o.n(r);class l extends(a()){constructor(e){super(),this.socket=new WebSocket(e),this.socket.addEventListener("open",(()=>{this.emit("connection",this.socket)})),this.socket.addEventListener("message",(({data:e})=>{console.log(e.event),console.log(e),e=JSON.parse(e),this.emit(e.event,e.payload)})),this.socket.addEventListener("close",(e=>{this.emit("disconnect",e)}))}send(e,t){this.socket.send(JSON.stringify({event:e,payload:t}))}}function c(e,t){const o=document.createElement("li");return o.classList.add("message--service"),o.classList.add("message"),o.textContent="on"==t?`${e} вошёл в чат`:`${e} вышел из чата`,o}const d=new l("ws://localhost:8000"),i=document.querySelector('[data-role="messageList"]');d.on("connection",(()=>{document.querySelector('[data-send="user"]').addEventListener("click",(e=>{e.preventDefault();const t=document.querySelector('[data-role="login-form"]'),o=document.querySelector('[data-role="overlay"]'),s=t.querySelector("#login").value.trim();s&&(t.classList.add("login--hidden"),i.setAttribute("data-name",s),o.style.width="0%",d.send("user:on",{message:s})),t.querySelector("#login").value=""})),document.querySelector('[data-send="message"]').addEventListener("click",(o=>{o.preventDefault();const s=document.querySelector("#inputMessage").value.trim(),r=i.getAttribute("data-name"),a={message:(c=s,c.replace(t,n)),time:(l=new Date,`${l.getHours()}:${l.getMinutes()}`),name:r};var l,c;let u=i.lastElementChild,m=u.querySelector(".user__list");r===u.getAttribute("data-name")?(console.log("simpleMessage"),m.innerHTML+=e.render("simpleMessageRight",a)):(console.log("complexMessage"),i.innerHTML+=e.render("complexMessageRight",a)),d.send("message:add",a),document.querySelector("#inputMessage").value="",i.scrollTop=i.scrollHeight})),document.querySelector("#hamburger").addEventListener("click",(e=>{console.log("ткнули ")})),document.addEventListener("click",(e=>{if(e.preventDefault(),"user-photo"===e.target.getAttribute("data-role")||"user-photo"===e.target.parentNode.getAttribute("data-role")){const e=document.querySelector('[data-role="form-photo"]');e.style.display="block";const t=i.getAttribute("data-name");e.querySelector(".form__photo--name").textContent=t;const o=document.querySelector('[data-role="overlay"]');o.style.width="100%",o.style.opacity=".6"}}))})),d.on("user:on",(e=>{console.log(e);const t=c(e.message,"on");i.appendChild(t)})),d.on("user:off",(e=>{const t=c((e=JSON.parse(e)).message,"off");i.appendChild(t)})),d.on("usersList",(t=>{t=JSON.parse(t),document.querySelector("#users").innerHTML=e.render("users",{list:t.list});const o=document.querySelector('[data-role="countOfUsers"]'),s=document.querySelector('[data-role="value"]'),n=t.list.length;n&&(o.textContent=n,s.textContent=function(e,t){let o=Math.abs(e)%100,s=o%10;return o>10&&o<20?t[2]:s>1&&s<5?t[1]:1==s?t[0]:t[2]}(n,["участник","участника","участников"]))})),d.on("message:add",(t=>{const o=i.getAttribute("data-name"),s=i.lastElementChild,n=s.querySelector(".user__list");o!==t.name&&(t.name===s.getAttribute("data-name")?(console.log(o),console.log(s.getAttribute("data-name")),n.innerHTML+=e.render("simpleMessage",t)):(console.log("complexMessage"),i.innerHTML+=e.render("complexMessage",t))),i.scrollTop=i.scrollHeight}))})()})();